% Copyright (C) 2021 by P. Vahr. 
% 
% contact me via GItHub if needed
% -------------------------------------------------------
%  under GNU General Public License v3.0 

% This theme is based on:
% 		- Verona theme, Copyright (C) 2015 by Ivan Valbusa 
%		- Metropolis theme for the Font family.





\ProvidesPackage{beamerthemeMilano}[2022  v.0.1 Themes for the Beamer class]

\mode<presentation>


% Packages TODO CHECK IT LATER ON
\RequirePackage{tikz}
\RequirePackage{tcolorbox}
  %\tcbuselibrary{skins}
\RequirePackage{fontspec}

% ******************
% colortheme -- all colors are defined here as RGB triplets (/256)
% ******************
\definecolor{lightorange}{RGB}{238,118,0} %a different orange
\definecolor{MIgreen}    {RGB}{0,152,0}
\definecolor{MIblue}     {RGB}{0,51,102}
\definecolor{MIorange}   {RGB}{238,118,0}
\definecolor{MIred}      {RGB}{246,29,29}
\definecolor{MIgray}     {RGB}{97,97,102} % reference gray
\definecolor{MIgrayblue} {RGB}{0,128,128}
\definecolor{MIgraygreen}{RGB}{128,128,0}
\definecolor{MIproBackground}{RGB}{250,250,250}
\definecolor{MIproBackground}{RGB}{240,240,240}

\setbeamercolor{frametitle}{fg=MIgray}
\setbeamercolor{framesubtitle}{fg=MIgray!50!white} % trick to make it lighter

\setbeamercolor{alerted text}{fg=MIorange}
\setbeamercolor{example text}{fg=MIgreen}
\setbeamercolor{structure}{fg=MIorange}


\setbeamercolor*{author in head/foot}{fg=MIgray,bg=}
\setbeamercolor*{title in head/foot}{fg=MIgray,bg=}
\setbeamercolor*{date in head/foot}{fg=MIgray,bg=}
\setbeamercolor*{section in head/foot}{fg=MIgray!80,bg=}
\setbeamercolor*{subsection in head/foot}{fg=MIgray!80,bg=}

% presentation title and subtitle here
\setbeamercolor*{title}{fg=white, bg=MIgray}
\setbeamercolor*{subtitle}{fg=white, bg=MIgray}
\setbeamercolor*{author}{fg=black, bg=MIgray}
\setbeamercolor*{date}{fg=MIgray}


\setbeamercolor*{page number in head/foot}{fg=MIred!80!black}
\setbeamercolor{background canvas}{bg=MIproBackground}
% blocks
%\setbeamercolor{block title}{use=structure,fg=structure.fg,bg=structure.fg!10!bg}
%\setbeamercolor{block title alerted}{use=alerted text,fg=alerted text.fg,bg=alerted text.fg!10!bg}
%\setbeamercolor{block title example}{use=example text,fg=example text.fg,bg=example text.fg!10!bg}
%
%\setbeamercolor{block body}{parent=normal text,use=block title,bg=block title.bg}
%\setbeamercolor{block body alerted}{parent=normal text,use=block title alerted,bg=block title alerted.bg}
%\setbeamercolor{block body example}{parent=normal text,use=block title example,bg=block title example.bg}



% ******************
% fonttheme
% ******************
% These fonts works only with LauLaTeX or XeLaTeX, but they are very nice.
% If you want to stick to pdflatex, add OT at the end of each font name, like BoldFont={Fira Sans OT}.
% See the documentation of the metropolis package for more info (texdoc metropolis on terminal). 
\setsansfont[ItalicFont={Fira Sans Thin},
	BoldFont={Fira Sans Regular},%
	BoldItalicFont={Fira Sans Italic}]%
 	{Fira Sans Light}
\setmonofont[BoldFont={Fira Mono Medium}]{Fira Mono}


\setbeamerfont{frametitle}{size=\Large,series=\bfseries} 			%Presentation title font size and type
\setbeamerfont{framesubtitle}{size=\large, series=\mdseries}
% \setbeamerfont{page number in head/foot}{size=\scriptsize, series=\mdseries} %footnote number
\setbeamerfont{normal text}{size=\normalsize}
\setbeamerfont{block title}{size=\normalsize, series=\bfseries}
\setbeamerfont{block title alerted}{size=\normalsize, series=\bfseries}

\setbeamerfont{caption}{size=\small} %?? useless?
\setbeamerfont{caption name}{series=\bfseries} %?? useless?
\setbeamerfont{description item}{series=\bfseries} %?? useless?


% ******************
% innertheme
% ******************
\setbeamertemplate{itemize item}[square] % style of bullet itemz
\setbeamertemplate{itemize subitem}[square]
\setbeamertemplate{blocks}[rounded][shadow=false]
%\setbeamercolor{quotation}{bg=black!5}



% ******************************************************
% outertheme
% ******************************************************
\setbeamertemplate{navigation symbols}{} %remove those ugly navigation symbols. Who ever used them?!

% ??
\let\oldtitlegraphic\titlegraphic
\renewcommand{\titlegraphic}[3][]{%
	\oldtitlegraphic{\node[inner sep=0pt,anchor=north west,#3] at (titlepage) {\includegraphics[#1]{#2}}}}



% ******************
% footline
% ******************
% just kidding, there is none. Because there MUST be none.
\setbeamertemplate{footline}{
}





% ******************
% title page
% ******************
\setbeamertemplate{title page}
{
  \begingroup % it's a TeX's primitive. Like {, but more powerfull. 
  \begin{tikzpicture}[overlay, remember picture]
  \draw[fill=MIgray, draw=none] (current page.north west) rectangle (\paperwidth,-.3cm); % gray top rectangle
		\node[xshift=-5cm,yshift=-4.1cm, thick] at (current page.south) (titlepage) {};
		\draw (0cm, 0mm) -- (30:2cm);
%	  \inserttitlegraphic;
		\node at (current page) {\includegraphics[width=.3\columnwidth]{./img/l+2}};
		\draw[ line width=4mm, xshift=3pt, draw=structure.fg, yshift=-1mm] (0,0) -- (\paperwidth,0) {}; % orange horizontal line
		\node[ anchor=south west, align=left] at (0,.25) {%  node for title and subtitle
\parbox{12cm}{%     
\usebeamerfont{title}\usebeamercolor[fg]{title}\bfseries \inserttitle\par%
      \ifx\insertsubtitle\@empty%
      \else\vskip.5ex%
        {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}
        \insertsubtitle\par}%
      \fi}};
\node[anchor=north west,align=left] at (0,-.4) {% node for authors etc
\parbox{0.35\textwidth}{
	\vskip5pt
      {\usebeamerfont{author}\usebeamercolor[fg]{author}\bfseries \insertauthor}
 %     \usebeamercolor[fg]{date} \usebeamerfont{date} \tiny \@mail
    \vskip3mm
      \usebeamerfont{institute}\usebeamercolor[fg]{author}\insertinstitute
    \vskip6mm
%      \usebeamercolor[fg]{date}\usebeamerfont{date}\insertdate
%      \vskip3mm \@mail
%      {\usebeamerfont{author}\usebeamercolor[fg]{date}\scriptsize\ttfamily\@mail}  
%	{\usebeamerfont{institute}\alert{Hybrid trap team}}  
%	{\tiny
%	{\footnotesize\bfseries\alert{Hybrid trap team}\par}
%	\vspace{3pt}
%	\textcolor{lightgray!30!black}{
%	AA \hfill BB\\
%	CC \hfill dd\\
%	EE \hfill FF \\ 
%	GG 	\hfill HH}\par}
%	\vskip14.5pt
	\includegraphics[width=120pt]{./img/univ_logo}
}}; 
  \end{tikzpicture}
  \endgroup
}

% ******************
% title page WITHOUT TIKZ 
% ******************
\setbeamertemplate{title page}
{
	\textcolor{white}{bla}
 % title and subtitle    
 \usebeamerfont{title}\usebeamercolor[bg]{title}\bfseries \inserttitle\par%
	\ifx\insertsubtitle\@empty 
	\else\vskip.5ex%
	{\usebeamerfont{subtitle}\usebeamercolor[bg]{subtitle}
		\insertsubtitle\par}%
	\fi

% horizontal bar with tikz
\begin{tikzpicture}[overlay] % overlay option findamental to get margins and stuff right
	\draw[ fill=MIgray, draw=none] (-25pt, 0) -- (\paperwidth, 0) -- (\paperwidth, 3cm) -- (-25pt, 3cm) -- cycle ; % gray top rectangle
	\draw[ line width=6pt, MIorange, yshift=+3pt] (0pt, 0pt) -- (\paperwidth - 25pt, 0);
\end{tikzpicture}

\begin{columns}[onlytextwidth, t]
\column{0.5\textwidth} % column for authior, date, place, logo
	\vskip5pt
	{\usebeamerfont{author}\usebeamercolor[fg]{author}\bfseries \insertauthor}
	 \vskip6pt
	{ \usebeamerfont{institute}\usebeamercolor[fg]{author}\insertinstitute } 
	\vskip 10pt
	{ \usebeamercolor[fg]{date} \usebeamerfont{date} \small \insertdate }
	\vfill
		\includegraphics[width=120pt]{./img/univ_logo}

\column{0.5\textwidth} % column for graphics
\begin{center}
\includegraphics[width=\columnwidth]{./img/l+_w_b.pdf}
\end{center}

\end{columns}
}







% ******************
% frametitle
% ******************

% sidebar shrinks to zero.
% No sidebar intended for this theme. Most of the times it's only graphical noise, reducing signal-to-noise ratio of your presentation
\setbeamersize{sidebar width left=0cm}  
\setbeamersize{sidebar width right=0cm}
\setbeamersize{text margin left = 25pt}
\setbeamersize{text margin right = 25pt}
%alternative way, but a bit deprecated:
%\setlength{\beamer@leftmargin}{25pt}
%\setlength{\beamer@rightmargin}{25pt}

\newlength{\frametitlesidebar} % USELESS???!!! GET RID OF IT
\setlength{\frametitlesidebar}{\dimexpr(\paperwidth-\beamer@leftmargin-\beamer@rightmargin)}  %\numexpr, \dimexpr, \glueexpr, \muexpr are other 4 TeX's primitive!!
\setbeamertemplate{frametitle}
{
\vspace{15pt} %looks like in Beamer doesn't exist any vertical margin length. It should be based on the geometry package, yet better not invoke it. The only knwon workaround is to add space in headline and footline. This will not work for frames with the [plain] options and it's pretty dirty. 

% put an unecessary horizontal line at the top
%\begin{tikzpicture}[overlay]
%\draw[line width=1pt,draw=structure.fg,yshift=10pt] (0,0) -- (\textwidth,0);%draw=structure.fg takes the foreground color. 
%yshift shift +(-) upwards (downwards) all the coordinates given.
%\end{tikzpicture}

%\ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%??
  
\begin{beamercolorbox}[sep=0.cm,left,wd=\textwidth]{frametitle}  %%[options]{beamercolor}
	\usebeamerfont{frametitle}%
	%\vbox{}\vskip-1ex %?? mystery here!
    \strut\insertframetitle\strut\par%  $a strut is a rule with no width and a fixed height, defined as \rule[-.3\baselineskip]{0pt}{\baselineskip}
	{%
		\ifx\insertframesubtitle\@empty%
		\else%
    	{\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\strut\insertframesubtitle\strut\par}%
		\fi
	}%
	%\vskip-1ex% ??
	%\if@tempswa\else\vskip-1ex\fi% set inside beamercolorbox... evil here... ??
\end{beamercolorbox}%

\begin{tikzpicture}[overlay]
\draw[line width=2pt,draw=structure.fg,yshift=.5ex] (-\beamer@leftmargin,0) -- (\textwidth,0);
\end{tikzpicture}
}



% ******************
% new commands
% ******************

\renewcommand{\maketitle}{%
\begin{frame}[plain]
\titlepage
\end{frame}}

% useful for reference a paper at the bottom of slide
% usage \reference{Paper 1 \hfill Paper 2}
\newcommand{\reference}[1]{
	\vfill 
	{\tiny
		\textcolor{lightgray!30!black}{
			{#1\\}}
	}\par
}

% split page exaclty in two without leaving extra space ("onlytextwidth")
\newcommand{\bisplit}[2]{ 
	%	\vspace{-15pt}
	\begin{columns}[onlytextwidth]
		\column[t]{0.5\textwidth}
		{#1}
		\column[t]{0.5\textwidth}
		{#2}
	\end{columns}
}

% usefull V and X ticks, but they do not belong to the theme. Use them in the main .tex file
% \newcommand{\success}{ \textcolor{MIgreen}{\checkmark} }
% \newcommand{\fail}{ \textcolor{MIred}{\ding{55}~~}}


\mode  % don't delete
<all>

\endinput
%%
%% End of file `beamerthemeMilano.sty'.


